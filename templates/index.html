{% extends "base.html" %}
{% block title %}Cat&aacute;logo &middot; PokeShop{% endblock %}
{% block content %}
<h1>Cat&aacute;logo</h1>
<div class="hero">
  <h1>Cat&aacute;logo</h1>
  <p>Descubre peluches, figuras y cartas TCG con b&uacute;squeda inteligente.</p>
</div>
<form class="filters" action="{{ url_for('index') }}">
  <input type="hidden" name="q" value="{{ q }}">
  <select name="tipo">
    <option value="">Tipo (todos)</option>
    {% for t in ['fuego','agua','eléctrico','planta','hielo','roca','dragón','psíquico','siniestro','lucha','acero','incoloro'] %}
      <option value="{{t}}" {% if tipo==t %}selected{% endif %}>{{t|capitalize}}</option>
    {% endfor %}
  </select>
  <select name="cat">
    <option value="">Categor&iacute;a (todas)</option>
    <option value="tcg" {% if cat=='tcg' %}selected{% endif %}>TCG</option>
    <option value="general" {% if cat=='general' %}selected{% endif %}>General/Merch</option>
  </select>
  <select name="sort">
    <option value="new" {% if sort=='new' %}selected{% endif %}>Novedades</option>
    <option value="price_asc" {% if sort=='price_asc' %}selected{% endif %}>Precio ↑</option>
    <option value="price_desc" {% if sort=='price_desc' %}selected{% endif %}>Precio ↓</option>
  </select>
  {% if cat == 'tcg' %}
    <select name="exp"><option value="">Expansi&oacute;n (todas)</option>
      {% for v in facets.exp %}<option value="{{v}}" {% if exp==v %}selected{% endif %}>{{v}}</option>{% endfor %}
    </select>
    <select name="rare"><option value="">Rareza (todas)</option>
      {% for v in facets.rare %}<option value="{{v}}" {% if rare==v %}selected{% endif %}>{{v}}</option>{% endfor %}
    </select>
    <select name="lang"><option value="">Idioma (todos)</option>
      {% for v in facets.lang %}<option value="{{v}}" {% if lang==v %}selected{% endif %}>{{v}}</option>{% endfor %}
    </select>
    <select name="cond"><option value="">Condici&oacute;n (todas)</option>
      {% for v in facets.cond %}<option value="{{v}}" {% if cond==v %}selected{% endif %}>{{v}}</option>{% endfor %}
    </select>
  {% endif %}
  <button>Aplicar</button>
</form>

{% if featured_tcg and (not q) and (not tipo) and (not cat or cat=='tcg') %}
  <h3 style="margin:8px 0">Cartas TCG destacadas</h3>
  <div class="grid">
    {% for p in featured_tcg %}
      <a class="card" href="{{ url_for('product_detail', pid=p.id) }}">
        <img src="{{ p.image_url or url_for('static', filename='noimg.png') }}" alt="{{ p.nombre }}">
        <div class="title">{{ p.nombre }}</div>
    <div class="badges">
      {% if p.categoria and p.categoria|lower == "tcg" %}<span class="badge">TCG</span>{% endif %}
      {% if p.stock is not none and p.stock <= 5 %}<span class="badge">Poco stock</span>{% endif %}
      {% if p.market_price is not none and p.precio_base < p.market_price %}<span class="badge">Oferta</span>{% endif %}
    </div>
        <div class="muted">Tipo: {{ p.tipo|capitalize }} &middot; TCG</div>
        <div class="price">$ {{ "%.2f"|format(p.precio_base) }}</div>
      </a>
    {% endfor %}
  </div>
{% endif %}

<h3 style="margin:8px 0">Todos los productos</h3>
<div class="grid">
  {% for p in products %}
  <a class="card" href="{{ url_for('product_detail', pid=p.id) }}">
    <img src="{{ p.image_url or url_for('static', filename='noimg.png') }}" alt="{{ p.nombre }}">
    <div class="title">{{ p.nombre }}</div>
    <div class="badges">
      {% if p.categoria and p.categoria|lower == "tcg" %}<span class="badge">TCG</span>{% endif %}
      {% if p.stock is not none and p.stock <= 5 %}<span class="badge">Poco stock</span>{% endif %}
      {% if p.market_price is not none and p.precio_base < p.market_price %}<span class="badge">Oferta</span>{% endif %}
    </div>
    <div class="muted">Tipo: {{ p.tipo|capitalize }} &middot; {{ p.categoria|capitalize }}</div>
    <div class="price">$ {{ "%.2f"|format(p.precio_base) }}</div>
    <div class="muted">Stock: {{ p.stock }}</div>
  </a>
  {% else %}
  <p>No hay productos.</p>
  {% endfor %}
</div>

{% if pag and pag.pages>1 %}
<nav class="row" style="margin-top:10px">
  <div>Página {{ pag.page }} de {{ pag.pages }}</div>
  <div>
    {% if pag.has_prev %}
      <a class="btn" href="{{ url_for('index', q=q, tipo=tipo, cat=cat, sort=sort, exp=exp, rare=rare, lang=lang, cond=cond, page=pag.prev_num) }}">← Anterior</a>
    {% endif %}
    {% if pag.has_next %}
      <a class="btn" href="{{ url_for('index', q=q, tipo=tipo, cat=cat, sort=sort, exp=exp, rare=rare, lang=lang, cond=cond, page=pag.next_num) }}">Siguiente →</a>
    {% endif %}
  </div>
</nav>
{% endif %}
{% endblock %}

